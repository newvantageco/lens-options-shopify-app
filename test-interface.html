<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ Lens Options App - Testing Interface</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #2c2c2c;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.12);
            overflow: hidden;
        }

        .header {
            background: #2c2c2c;
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.8;
            font-size: 1.1rem;
        }

        .content {
            padding: 30px;
        }

        .test-section {
            margin-bottom: 30px;
            border: 1px solid #e8e8e8;
            border-radius: 8px;
            overflow: hidden;
        }

        .test-header {
            background: #f8f8f8;
            padding: 20px;
            border-bottom: 1px solid #e8e8e8;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .test-header:hover {
            background: #f0f0f0;
        }

        .test-header h3 {
            font-size: 1.3rem;
            color: #2c2c2c;
        }

        .test-content {
            padding: 20px;
            display: none;
        }

        .test-content.active {
            display: block;
        }

        .test-button {
            background: #2c2c2c;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.2s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .test-button:hover {
            background: #1a1a1a;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(44, 44, 44, 0.2);
        }

        .test-button:disabled {
            background: #e8e8e8;
            color: #999;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }

        .result.success {
            background: #f0f9f7;
            border: 1px solid #d1f2eb;
            color: #0f5132;
        }

        .result.error {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #991b1b;
        }

        .result.info {
            background: #eff6ff;
            border: 1px solid #dbeafe;
            color: #1e40af;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #2c2c2c;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #e8e8e8;
            border-radius: 6px;
            font-size: 14px;
        }

        .form-group textarea {
            height: 100px;
            resize: vertical;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-indicator.online {
            background: #10b981;
        }

        .status-indicator.offline {
            background: #ef4444;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .quick-actions {
            background: #f8f8f8;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .quick-actions h3 {
            margin-bottom: 15px;
            color: #2c2c2c;
        }

        .server-status {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #f0f9f7;
            border: 1px solid #d1f2eb;
            border-radius: 6px;
        }

        .server-status.offline {
            background: #fef2f2;
            border-color: #fecaca;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 8px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß™ Lens Options App</h1>
            <p>Interactive Testing Interface</p>
        </div>

        <div class="content">
            <div class="server-status" id="serverStatus">
                <span class="status-indicator offline" id="statusIndicator"></span>
                <span id="statusText">Checking server status...</span>
            </div>

            <div class="quick-actions">
                <h3>üöÄ Quick Actions</h3>
                <button class="test-button" onclick="checkServerStatus()">Check Server Status</button>
                <button class="test-button" onclick="runAllTests()">Run All Tests</button>
                <button class="test-button" onclick="openFrontend()">Open Frontend</button>
                <button class="test-button" onclick="openAPI()">View API Docs</button>
            </div>

            <div class="grid">
                <div class="test-section">
                    <div class="test-header" onclick="toggleSection('health')">
                        <h3>üè• Health Check</h3>
                        <span>‚ñ∂</span>
                    </div>
                    <div class="test-content" id="health">
                        <p>Test the basic health endpoint to ensure the server is running.</p>
                        <button class="test-button" onclick="testHealth()">Test Health Check</button>
                        <div class="result" id="healthResult" style="display: none;"></div>
                    </div>
                </div>

                <div class="test-section">
                    <div class="test-header" onclick="toggleSection('prescriptions')">
                        <h3>üíä Prescriptions API</h3>
                        <span>‚ñ∂</span>
                    </div>
                    <div class="test-content" id="prescriptions">
                        <p>Test prescription creation, retrieval, and management.</p>
                        <button class="test-button" onclick="testPrescriptions()">Test Prescriptions</button>
                        <button class="test-button" onclick="createPrescription()">Create Test Prescription</button>
                        <div class="result" id="prescriptionsResult" style="display: none;"></div>
                    </div>
                </div>

                <div class="test-section">
                    <div class="test-header" onclick="toggleSection('lensflows')">
                        <h3>üîç Lens Flows API</h3>
                        <span>‚ñ∂</span>
                    </div>
                    <div class="test-content" id="lensflows">
                        <p>Test lens flow creation and management.</p>
                        <button class="test-button" onclick="testLensFlows()">Test Lens Flows</button>
                        <button class="test-button" onclick="createLensFlow()">Create Test Lens Flow</button>
                        <div class="result" id="lensflowsResult" style="display: none;"></div>
                    </div>
                </div>

                <div class="test-section">
                    <div class="test-header" onclick="toggleSection('orders')">
                        <h3>üì¶ Orders API</h3>
                        <span>‚ñ∂</span>
                    </div>
                    <div class="test-content" id="orders">
                        <p>Test order creation and management.</p>
                        <button class="test-button" onclick="testOrders()">Test Orders</button>
                        <button class="test-button" onclick="createOrder()">Create Test Order</button>
                        <div class="result" id="ordersResult" style="display: none;"></div>
                    </div>
                </div>

                <div class="test-section">
                    <div class="test-header" onclick="toggleSection('settings')">
                        <h3>‚öôÔ∏è Settings API</h3>
                        <span>‚ñ∂</span>
                    </div>
                    <div class="test-content" id="settings">
                        <p>Test app settings and configuration.</p>
                        <button class="test-button" onclick="testSettings()">Test Settings</button>
                        <button class="test-button" onclick="updateSettings()">Update Settings</button>
                        <div class="result" id="settingsResult" style="display: none;"></div>
                    </div>
                </div>

                <div class="test-section">
                    <div class="test-header" onclick="toggleSection('files')">
                        <h3>üìÅ Static Files</h3>
                        <span>‚ñ∂</span>
                    </div>
                    <div class="test-content" id="files">
                        <p>Test static file serving (CSS, JS).</p>
                        <button class="test-button" onclick="testStaticFiles()">Test Static Files</button>
                        <div class="result" id="filesResult" style="display: none;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const BASE_URL = 'http://localhost:3001';
        const API_BASE = `${BASE_URL}/api`;

        // Utility functions
        function showResult(elementId, content, type = 'info') {
            const element = document.getElementById(elementId);
            element.textContent = content;
            element.className = `result ${type}`;
            element.style.display = 'block';
        }

        function showError(elementId, error) {
            showResult(elementId, `Error: ${error}`, 'error');
        }

        function showSuccess(elementId, content) {
            showResult(elementId, content, 'success');
        }

        async function apiRequest(method, endpoint, data = null) {
            try {
                const config = {
                    method,
                    headers: {
                        'Content-Type': 'application/json'
                    }
                };
                
                if (data) {
                    config.body = JSON.stringify(data);
                }
                
                const response = await fetch(`${API_BASE}${endpoint}`, config);
                const result = await response.json();
                
                if (response.ok) {
                    return { success: true, data: result };
                } else {
                    return { success: false, error: result, status: response.status };
                }
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        // Test functions
        async function testHealth() {
            try {
                const response = await fetch(`${BASE_URL}/health`);
                const data = await response.json();
                
                if (response.ok) {
                    showSuccess('healthResult', `Health Check Passed!\n\nResponse: ${JSON.stringify(data, null, 2)}`);
                } else {
                    showError('healthResult', `Health check failed with status ${response.status}`);
                }
            } catch (error) {
                showError('healthResult', error.message);
            }
        }

        async function testPrescriptions() {
            const result = await apiRequest('GET', '/prescriptions');
            
            if (result.success) {
                showSuccess('prescriptionsResult', `GET Prescriptions Successful!\n\nFound ${result.data.length} prescriptions:\n${JSON.stringify(result.data, null, 2)}`);
            } else {
                showError('prescriptionsResult', result.error);
            }
        }

        async function createPrescription() {
            const newPrescription = {
                prescriptionType: 'single-vision',
                customerName: 'Test Customer',
                customerEmail: 'test@example.com',
                odSphere: '-2.00',
                osSphere: '-2.00',
                pd: '64',
                status: 'draft'
            };

            const result = await apiRequest('POST', '/prescriptions', newPrescription);
            
            if (result.success) {
                showSuccess('prescriptionsResult', `Prescription Created Successfully!\n\nID: ${result.data.id}\nData: ${JSON.stringify(result.data, null, 2)}`);
            } else {
                showError('prescriptionsResult', result.error);
            }
        }

        async function testLensFlows() {
            const result = await apiRequest('GET', '/lens-flows');
            
            if (result.success) {
                showSuccess('lensflowsResult', `GET Lens Flows Successful!\n\nFound ${result.data.length} lens flows:\n${JSON.stringify(result.data, null, 2)}`);
            } else {
                showError('lensflowsResult', result.error);
            }
        }

        async function createLensFlow() {
            const newLensFlow = {
                name: 'Test Lens Flow',
                description: 'A test lens flow for testing purposes',
                isActive: true,
                prescriptionTypes: [
                    {
                        name: 'single-vision',
                        displayName: 'Single Vision',
                        isActive: true
                    }
                ],
                lensGroups: [
                    {
                        name: 'clear-lenses',
                        displayName: 'Clear Lenses',
                        description: 'Standard clear prescription lenses',
                        sortOrder: 1,
                        isActive: true
                    }
                ],
                lenses: [],
                settings: {
                    showMatrixImage: true,
                    allowQuickBuy: true,
                    requirePrescriptionUpload: false
                }
            };

            const result = await apiRequest('POST', '/lens-flows', newLensFlow);
            
            if (result.success) {
                showSuccess('lensflowsResult', `Lens Flow Created Successfully!\n\nID: ${result.data.id}\nData: ${JSON.stringify(result.data, null, 2)}`);
            } else {
                showError('lensflowsResult', result.error);
            }
        }

        async function testOrders() {
            const result = await apiRequest('GET', '/orders');
            
            if (result.success) {
                showSuccess('ordersResult', `GET Orders Successful!\n\nFound ${result.data.length} orders:\n${JSON.stringify(result.data, null, 2)}`);
            } else {
                showError('ordersResult', result.error);
            }
        }

        async function createOrder() {
            const newOrder = {
                orderNumber: `LO-${Date.now()}`,
                customerEmail: 'customer@example.com',
                totalPrice: 199.99,
                currency: 'USD',
                status: 'pending',
                selectedLens: {
                    lensName: 'Standard Clear',
                    lensType: 'clear',
                    basePrice: 50.00
                }
            };

            const result = await apiRequest('POST', '/orders', newOrder);
            
            if (result.success) {
                showSuccess('ordersResult', `Order Created Successfully!\n\nID: ${result.data.id}\nData: ${JSON.stringify(result.data, null, 2)}`);
            } else {
                showError('ordersResult', result.error);
            }
        }

        async function testSettings() {
            const result = await apiRequest('GET', '/settings');
            
            if (result.success) {
                showSuccess('settingsResult', `GET Settings Successful!\n\nCurrent Settings:\n${JSON.stringify(result.data, null, 2)}`);
            } else {
                showError('settingsResult', result.error);
            }
        }

        async function updateSettings() {
            const updatedSettings = {
                customCSS: '/* Test CSS Update */',
                customJS: '// Test JS Update',
                nativeBundling: true,
                singleLineitemBundling: false,
                savePrescriptionInOrder: true,
                encryptPrescriptionData: true,
                dataRetentionDays: 2555
            };

            const result = await apiRequest('PUT', '/settings', updatedSettings);
            
            if (result.success) {
                showSuccess('settingsResult', `Settings Updated Successfully!\n\nUpdated Settings:\n${JSON.stringify(result.data, null, 2)}`);
            } else {
                showError('settingsResult', result.error);
            }
        }

        async function testStaticFiles() {
            const files = ['/lens-options.js', '/lens-options.css'];
            let results = [];

            for (const file of files) {
                try {
                    const response = await fetch(`${BASE_URL}${file}`);
                    if (response.ok) {
                        const content = await response.text();
                        results.push(`‚úÖ ${file}: Accessible (${content.length} bytes)`);
                    } else {
                        results.push(`‚ùå ${file}: Not accessible (${response.status})`);
                    }
                } catch (error) {
                    results.push(`‚ùå ${file}: Error - ${error.message}`);
                }
            }

            showResult('filesResult', results.join('\n'), 'info');
        }

        // UI functions
        function toggleSection(sectionId) {
            const content = document.getElementById(sectionId);
            const header = content.previousElementSibling;
            const arrow = header.querySelector('span');
            
            if (content.classList.contains('active')) {
                content.classList.remove('active');
                arrow.textContent = '‚ñ∂';
            } else {
                content.classList.add('active');
                arrow.textContent = '‚ñº';
            }
        }

        async function checkServerStatus() {
            const statusElement = document.getElementById('serverStatus');
            const indicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');

            try {
                const response = await fetch(`${BASE_URL}/health`);
                if (response.ok) {
                    statusElement.className = 'server-status';
                    indicator.className = 'status-indicator online';
                    statusText.textContent = 'Server is online and running!';
                } else {
                    throw new Error(`Server responded with status ${response.status}`);
                }
            } catch (error) {
                statusElement.className = 'server-status offline';
                indicator.className = 'status-indicator offline';
                statusText.textContent = `Server is offline: ${error.message}`;
            }
        }

        async function runAllTests() {
            const tests = [
                { name: 'Health Check', fn: testHealth, resultId: 'healthResult' },
                { name: 'Prescriptions', fn: testPrescriptions, resultId: 'prescriptionsResult' },
                { name: 'Lens Flows', fn: testLensFlows, resultId: 'lensflowsResult' },
                { name: 'Orders', fn: testOrders, resultId: 'ordersResult' },
                { name: 'Settings', fn: testSettings, resultId: 'settingsResult' },
                { name: 'Static Files', fn: testStaticFiles, resultId: 'filesResult' }
            ];

            let results = [];
            
            for (const test of tests) {
                try {
                    await test.fn();
                    results.push(`‚úÖ ${test.name}: PASSED`);
                } catch (error) {
                    results.push(`‚ùå ${test.name}: FAILED - ${error.message}`);
                }
            }

            // Show summary
            const summary = `üß™ Test Results Summary:\n\n${results.join('\n')}\n\n${results.filter(r => r.includes('‚úÖ')).length}/${results.length} tests passed`;
            showResult('healthResult', summary, 'info');
            
            // Open health section to show results
            document.getElementById('health').classList.add('active');
            document.querySelector('#health .test-header span').textContent = '‚ñº';
        }

        function openFrontend() {
            window.open('http://localhost:5173', '_blank');
        }

        function openAPI() {
            window.open(`${BASE_URL}/health`, '_blank');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            checkServerStatus();
            
            // Check server status every 30 seconds
            setInterval(checkServerStatus, 30000);
        });
    </script>
</body>
</html>
